var map,orders=[],coordinates=[],addresses=[];function initMap(){let e=new ymaps.control.SearchControl({options:{size:"large",provider:"yandex#search"}});map=new ymaps.Map("map",{center:[41.26465,69.21627],zoom:12,controls:[e,"fullscreenControl","zoomControl"]}),collectOrders(),fillMap()}function fillMap(e){let t;t=void 0===e?orders:e,map.geoObjects.removeAll();let a=[],n=[];t.forEach(e=>{a.push(e.coordinates),n.push(e.address)});let o=[];for(let e=0;e<a.length;e++)o[e]=new ymaps.GeoObject({geometry:{type:"Point",coordinates:a[e]},properties:{clusterCaption:"Заказ № "+(e+1),balloonContentBody:n[e],hintContent:n[e]}},{preset:"islands#orangeDotIcon"});let s=new ymaps.Clusterer({clusterDisableClickZoom:!0,preset:"islands#orangeClusterIcons"});s.add(o),map.geoObjects.add(s)}function collectOrders(){document.querySelectorAll(".location-item").forEach(e=>{let t=e.getElementsByClassName("latitude")[0].innerHTML,a=e.getElementsByClassName("longitude")[0].innerHTML,n=e.getElementsByClassName("address")[0].innerHTML,o=e.getElementsByClassName("date")[0].innerHTML;orders.push({coordinates:[t,a],address:n,date:o}),coordinates.push([t,a]),addresses.push(addresses)})}function dateRangeSelected(e,t){if("Весь период"===e._i||"Весь период"===t._i)return $("#daterange span").html("Весь период"),void fillMap();$("#daterange span").html(e.format("DD.MM.YYYY")+" - "+t.format("DD.MM.YYYY"));let a=moment(e.format("DD.MM.YYYY"),"DD.MM.YYYY"),n=moment(t.format("DD.MM.YYYY"),"DD.MM.YYYY");fillMap(orders.filter(e=>{let t=moment(e.date,"DD.MM.YYYY");return a.isSame(n)?t.isSame(a):t.isBetween(a,n)}))}function initDateRangePicker(){$("#daterange").daterangepicker({maxDate:moment(),ranges:{"Весь период":["Весь период","Весь период"],"Сегодня":[moment(),moment()],"Вчера":[moment().subtract(1,"days"),moment().subtract(1,"days")],"Последние 7 дней":[moment().subtract(6,"days"),moment()],"Последние 30 дней":[moment().subtract(29,"days"),moment()],"Этот месяц":[moment().startOf("month"),moment()],"Прошлый месяц":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")]},locale:{format:"DD.MM.YYYY",separator:" - ",applyLabel:"Применить",cancelLabel:"Отменить",fromLabel:"От",toLabel:"До",customRangeLabel:"Своя дата",weekLabel:"Н",daysOfWeek:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],monthNames:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],firstDay:1}},dateRangeSelected)}ymaps.ready(initMap),$(()=>{initDateRangePicker()});